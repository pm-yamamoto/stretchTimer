# ストレッチタイマーPWA 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト情報
- **アプリケーション名**: ストレッチタイマー
- **アプリケーションタイプ**: PWA（Progressive Web App）
- **目的**: 定期的なストレッチを促進し、ユーザーの健康をサポートする
- **エントリーポイント**: `htdocs/`
- **対象ユーザー**: デスクワーカー、長時間作業を行う人

### 1.2 プロジェクトの背景と目標
- 長時間の座り作業による健康問題の解決
- 定期的な運動習慣の促進
- 簡単で続けやすいストレッチの実行支援

## 2. 機能要件

### 2.1 基本機能

#### 2.1.1 タイマー設定機能
- **ID**: REQ-001
- **優先度**: 高
- **説明**: ストレッチを促す間隔時間を設定できる機能
- **詳細要件**:
  - 設定可能範囲: 15分〜240分
  - プリセット間隔: 30分、60分、90分、120分
  - カスタム間隔設定（1分単位）
  - 設定値の永続化（LocalStorage使用）
  - 設定の復元機能

#### 2.1.2 タイマー実行機能
- **ID**: REQ-002
- **優先度**: 高
- **説明**: 設定された間隔でタイマーを実行し、通知を行う
- **詳細要件**:
  - バックグラウンドでの時間計測
  - 満了時の通知表示
  - 一時停止・再開機能
  - リセット機能

#### 2.1.3 ストレッチ完了確認システム
- **ID**: REQ-003
- **優先度**: 高
- **説明**: 二段階の検出条件により「ストレッチ完了」ボタンを有効化し、完了を記録
- **詳細要件**:

**完了検出条件（両方必須）**
1. **立位検知**: DeviceOrientationAPIによる立った姿勢の検出
   - 縦方向（portrait）の向きを維持
   - 検出閾値: ±30度程度
   - 緑色のチェック状態で「立位検知済み」表示

2. **方向一致**: デバイスが指定方向を向いていることの確認
   - 特定の方位（例：東方向）への向きを検出
   - リアルタイムで現在方向を表示
   - 不一致時は「方向不一致（現在方向）」を警告表示

**完了ボタン制御**
- 上記2条件が両方満たされた場合のみ「ストレッチ完了を記録」ボタンを押下可能
- 条件未満時はボタンを無効化（グレーアウト）
- ボタン押下で完了記録し、次回タイマー開始

### 2.2 通知機能
- **ID**: REQ-004
- **優先度**: 中
- **説明**: ストレッチタイムを知らせる通知機能
- **詳細要件**:
  - ブラウザプッシュ通知
  - 振動通知（対応デバイス）
  - 音声通知（オプション）
  - 通知のカスタマイズ設定

### 2.3 データ保存機能
- **ID**: REQ-005
- **優先度**: 中
- **説明**: ユーザー設定とストレッチ履歴の保存
- **詳細要件**:
  - タイマー設定の保存
  - ストレッチ完了履歴（日時記録）
  - 統計データの保存（週間・月間完了数）

## 3. PWA要件

### 3.1 PWA基本要件
- **ID**: REQ-006
- **優先度**: 高
- **説明**: PWAとしての基本機能を満たす
- **詳細要件**:
  - Web App Manifest設定
  - Service Worker実装
  - HTTPSでの配信
  - インストール可能な設計
  - オフライン対応（基本機能のみ）

### 3.2 マニフェスト設定
- **アプリ名**: "ストレッチタイマー"
- **ショート名**: "ストレッチ"
- **アイコンサイズ**: 192x192px, 512x512px
- **表示モード**: standalone
- **開始URL**: "/"
- **背景色**: #ffffff
- **テーマカラー**: #4CAF50

### 3.3 Service Worker機能
- 基本リソースのキャッシュ（HTML, CSS, JS）
- オフライン時の基本表示
- バックグラウンドでの通知管理

## 4. 非機能要件

### 4.1 パフォーマンス要件
- **ID**: NFR-001
- **初期読み込み時間**: 3秒以内
- **Lighthouse PWAスコア**: 90以上
- **First Contentful Paint**: 2秒以内
- **Time to Interactive**: 3秒以内

### 4.2 互換性要件
- **ID**: NFR-002
- **対応ブラウザ**:
  - Chrome 80+
  - Safari 14+
  - Firefox 70+
  - Edge 80+
- **対応デバイス**:
  - スマートフォン（iOS 14+, Android 8+）
  - タブレット
  - デスクトップ（参考対応）

### 4.3 セキュリティ要件
- **ID**: NFR-003
- **要件**:
  - HTTPS必須配信
  - 適切な権限管理（通知、デバイス向き）
  - XSS対策
  - データ暗号化（必要に応じて）

### 4.4 アクセシビリティ要件
- **ID**: NFR-004
- **要件**:
  - WCAG 2.1 AA準拠
  - カラーコントラスト比4.5:1以上
  - キーボードナビゲーション対応
  - スクリーンリーダー対応

### 4.5 ユーザビリティ要件
- **ID**: NFR-005
- **要件**:
  - 直感的なUI設計
  - 大きなタップ領域（44px以上）
  - レスポンシブデザイン
  - ダークモード対応

## 5. システム制約

### 5.1 技術制約
- Vanilla JavaScript使用（フレームワーク不使用）
- WebAPIの利用可能性に依存
- ブラウザの通知許可が必要
- HTTPS環境での動作が前提

### 5.2 運用制約
- サーバーサイド処理なし（静的サイト）
- クライアントサイドでの完結動作
- 外部APIへの依存なし

## 6. 受け入れ基準

### 6.1 機能テスト
- [ ] タイマー設定が正常に保存・復元される
- [ ] 設定間隔でタイマーが正確に動作する
- [ ] 立位検知が正常に機能する
- [ ] 方向検知が正常に機能し、リアルタイム表示される
- [ ] 両条件満足時のみ完了ボタンが有効化される
- [ ] 完了ボタン押下で履歴記録と次回タイマー開始が行われる
- [ ] 通知が適切なタイミングで表示される
- [ ] PWAとしてインストール可能である

### 6.2 非機能テスト
- [ ] 各種ブラウザで正常に動作する
- [ ] モバイルデバイスで適切に表示される
- [ ] Lighthouse PWAスコア90以上を達成
- [ ] オフライン時の基本動作が可能
- [ ] アクセシビリティ要件を満たす

## 7. 除外項目

以下の機能は初期リリースの対象外とする：

- ユーザー認証機能
- データのクラウド同期
- 複数デバイス間での設定共有
- SNS連携機能
- 詳細な統計・分析機能
- カスタマイズ可能なストレッチメニュー

## 8. 今後の拡張予定

- ストレッチの種類選択機能
- 運動履歴の詳細統計
- リマインダーの詳細設定
- 健康データとの連携
- 複数ユーザー対応